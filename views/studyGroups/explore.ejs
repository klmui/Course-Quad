<%- include('../partials/header'); %>

<div id="loader" class="center"></div>

<div class="card">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="card-header ml-3" style="width: 100%;">
          <h3 class="card-title text-center">Explore Study Groups</h3>
        </div>
        <div class="card-body">

        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#searchStudyGroup"
          aria-expanded="false" aria-controls="searchStudyGroup" style="margin-left: 86%;">
          <i class="fas fa-search"></i> Advanced Search
        </button>

        <div class="collapse" id="searchStudyGroup">
          <div class="card card-body">
            <div class=form-group>
              <label for="studyGroupName">Study Group Name</label>
              <input type="text" class="form-control" id="studyGroupName" placeholder="CS 564 Study Group">
            </div>

            <div class=form-group>
              <select class="custom-select">
                <option selected>Term</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
              </select>
            </div>

            <div class=form-group>
              <p class="mb-1">Meeting times</p>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="M" value="option1">
                <label class="form-check-label" for="M">M</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="T" value="option2">
                <label class="form-check-label" for="T">T</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="W" value="option2">
                <label class="form-check-label" for="W">W</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="TH" value="option2">
                <label class="form-check-label" for="TH">TH</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="F" value="option2">
                <label class="form-check-label" for="F">F</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="SAT" value="option2">
                <label class="form-check-label" for="SAT">SAT</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="SUN" value="option2">
                <label class="form-check-label" for="SUN">SUN</label>
              </div>

              <div class="d-flex flex-row-reverse">
                <btn class="btn btn-primary mt-1">Search</btn>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- all study groups -->
        <table id="studyGroupTable" class="table table-striped table-bordered hover dataTable" style="width:100%">
          <thead>
            <tr>
              <th>Name</th>
              <th>Term</th>
              <th>Description</th>
              <th>M</th>
              <th>T</th>
              <th>W</th>
              <th>TH</th>
              <th>F</th>
              <th>SAT</th>
              <th>SUN</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% for (var i = 0; i < studyGroups.length; i++) { %>
              <tr>
                <td>
                  <div class="accordion" id="accordionExample">
                    <div class="card">
                      <div class="" id="headingOne" style="background-color: #F2F2F2;">
                        <h2 class="mb-0">
                          <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                            aria-expanded="true" aria-controls="collapseOne" id="studyGroupName<%=studyGroups[i].ID%>">
                            <%= studyGroups[i].name %>
                          </button>
                        </h2>
                      </div>

                      <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                        <div class="card-body">
                          <table id="usersTable<%=studyGroups[i].ID%>">
        
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                <td><%= studyGroups[i].Term %></td>
                <td><%= studyGroups[i].Description %></td></td>
                <% if (studyGroups[i].Monday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Tuesday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Wednesday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Thursday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Friday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Saturday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <% if (studyGroups[i].Sunday == 'Y') { %>
                  <td><i class="fa fa-check" aria-hidden="true"></i></td>
                <% } else { %>
                  <td><i class="fa fa-times" aria-hidden="true"></i></td>
                <% } %>

                <td>
                  <btn class="btn btn-primary btn askToJoin" title="Ask to join" id="<%= studyGroups[i].ID %>"><i class="far fa-envelope"></i></btn>
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  $('#loader').hide();

  var users = <%- JSON.stringify(users) %>;
  // load users into users table
  for (i in users) {
    var user = users[i];
    if (user.sort_order == '1') {
      // owner
      $('#usersTable' + user.ID).append(`
                           <tr>
                              <td>${user.username}</td>
                              <td id='organizer${user.ID}'>${user.email}</td>
                              <td>Organizer</td>
                            </tr>
      `);
    } else {
      $('#usersTable' + user.ID).append(`
                           <tr>
                              <td>${user.username}</td>
                              <td>${user.email}</td>
                            </tr>
      `);
    }
  }
  
  $('.askToJoin').on('click', function() {
    var studyGroupID = $(this).attr('id');
    var studyGroupName = $('#studyGroupName' + studyGroupID).text();
    var email = $('#organizer' + studyGroupID).text();
    var subject = "CourseQuad Study Group Request";
    var emailBody = "Hi there! I am looking to join " + studyGroupName.trim() + ". My username is <USERNAME>. Thank you!";
    document.location = "mailto:"+email+"?subject="+subject+"&body="+emailBody;
  });

  $('.nav-item').removeClass('active border rounded');
</script>

<%- include('../partials/footer'); %>